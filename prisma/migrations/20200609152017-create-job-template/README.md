# Migration `20200609152017-create-job-template`

This migration has been generated by Kervin at 6/9/2020, 3:20:17 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "myexactjobs-prisma-prod$prod"."JobTemplate" (
"author" text  NOT NULL ,"compensationType" text  NOT NULL DEFAULT E'hourly',"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text  NOT NULL ,"disclaimer" text   ,"id" text  NOT NULL ,"lastUserModified" text  NOT NULL ,"maxCompensation" Decimal(65,30)  NOT NULL ,"minCompensation" Decimal(65,30)  NOT NULL ,"name" text  NOT NULL ,"title" text  NOT NULL ,"type" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "myexactjobs-prisma-prod$prod"."_CategoryToJobTemplate" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToSkill" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToPerk" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "myexactjobs-prisma-prod$prod"."Application" ALTER COLUMN "status" SET DEFAULT E'NEW';

ALTER TABLE "myexactjobs-prisma-prod$prod"."ApplicationNote" ALTER COLUMN "type" SET DEFAULT E'NOTE';

ALTER TABLE "myexactjobs-prisma-prod$prod"."Job" ALTER COLUMN "status" SET DEFAULT E'DRAFT';

ALTER TABLE "myexactjobs-prisma-prod$prod"."User" ALTER COLUMN "status" SET DEFAULT E'ACTIVE';

CREATE UNIQUE INDEX "JobTemplate.name" ON "myexactjobs-prisma-prod$prod"."JobTemplate"("name")

CREATE UNIQUE INDEX "_CategoryToJobTemplate_AB_unique" ON "myexactjobs-prisma-prod$prod"."_CategoryToJobTemplate"("A","B")

CREATE  INDEX "_CategoryToJobTemplate_B_index" ON "myexactjobs-prisma-prod$prod"."_CategoryToJobTemplate"("B")

CREATE UNIQUE INDEX "_JobTemplateToSkill_AB_unique" ON "myexactjobs-prisma-prod$prod"."_JobTemplateToSkill"("A","B")

CREATE  INDEX "_JobTemplateToSkill_B_index" ON "myexactjobs-prisma-prod$prod"."_JobTemplateToSkill"("B")

CREATE UNIQUE INDEX "_JobTemplateToPerk_AB_unique" ON "myexactjobs-prisma-prod$prod"."_JobTemplateToPerk"("A","B")

CREATE  INDEX "_JobTemplateToPerk_B_index" ON "myexactjobs-prisma-prod$prod"."_JobTemplateToPerk"("B")

ALTER TABLE "myexactjobs-prisma-prod$prod"."JobTemplate" ADD FOREIGN KEY ("author")REFERENCES "myexactjobs-prisma-prod$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."JobTemplate" ADD FOREIGN KEY ("lastUserModified")REFERENCES "myexactjobs-prisma-prod$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_CategoryToJobTemplate" ADD FOREIGN KEY ("A")REFERENCES "myexactjobs-prisma-prod$prod"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_CategoryToJobTemplate" ADD FOREIGN KEY ("B")REFERENCES "myexactjobs-prisma-prod$prod"."JobTemplate"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToSkill" ADD FOREIGN KEY ("A")REFERENCES "myexactjobs-prisma-prod$prod"."JobTemplate"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToSkill" ADD FOREIGN KEY ("B")REFERENCES "myexactjobs-prisma-prod$prod"."Skill"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToPerk" ADD FOREIGN KEY ("A")REFERENCES "myexactjobs-prisma-prod$prod"."JobTemplate"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobTemplateToPerk" ADD FOREIGN KEY ("B")REFERENCES "myexactjobs-prisma-prod$prod"."Perk"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200603143752-create-perk-type..20200609152017-create-job-template
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 enum UserStatus {
   ACTIVE
@@ -88,11 +88,13 @@
   users User[]
 }
 model Category {
-  id   String @id @default(cuid())
-  name String @unique
-  jobs Job[]  @relation(references: [id])
+  id           String        @id @default(cuid())
+  name         String        @unique
+  jobs         Job[]         @relation(references: [id])
+  JobTemplates JobTemplate[] @relation(references: [id])
+
 }
 model Company {
   id          String    @id @default(cuid())
@@ -204,13 +206,14 @@
   users       User[]
 }
 model Skill {
-  id      String   @id @default(cuid())
-  name    String   @unique
-  jobs    Job[]    @relation(references: [id])
-  resumes Resume[] @relation(references: [id])
-  users   User[]   @relation(references: [id])
+  id           String        @id @default(cuid())
+  name         String        @unique
+  jobs         Job[]         @relation(references: [id])
+  resumes      Resume[]      @relation(references: [id])
+  users        User[]        @relation(references: [id])
+  jobTemplates JobTemplate[] @relation(references: [id])
 }
 model User {
   id           String        @id @default(cuid())
@@ -230,19 +233,48 @@
   branchId String? @map("branch")
   branch   Branch? @relation(fields: [branchId], references: [id])
-  resumes          Resume[]
-  resetToken       String?
-  resetTokenExpiry Float?
-  status           UserStatus        @default(ACTIVE)
-  applicationNotes ApplicationNote[]
-  perks            Perk[]
+  resumes              Resume[]
+  resetToken           String?
+  resetTokenExpiry     Float?
+  status               UserStatus        @default(ACTIVE)
+  applicationNotes     ApplicationNote[]
+  perks                Perk[]
+  createdJobTemplates  JobTemplate[]
+  modifiedJobTemplates JobTemplate[]     @relation("lastModifiedJobTemplates")
 }
 model Perk {
-  id       String @id @default(cuid())
-  name     String
-  jobs     Job[]  @relation(references: [id])
+  id           String        @id @default(cuid())
+  name         String
+  jobs         Job[]         @relation(references: [id])
+  authorId     String        @map("author")
+  author       User          @relation(fields: [authorId], references: [id])
+  JobTemplates JobTemplate[] @relation(references: [id])
+}
+
+model JobTemplate {
+  id               String   @id @default(cuid())
+  name             String   @unique
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt
+  title            String
+  compensationType String   @default("hourly")
+  description      String
+  disclaimer       String?
+  type             String
+  maxCompensation  Float
+  minCompensation  Float
+
   authorId String @map("author")
   author   User   @relation(fields: [authorId], references: [id])
+
+  lastModifiedUserId String @map("lastUserModified")
+  lastUserModified   User   @relation("lastModifiedJobTemplates", fields: [lastModifiedUserId], references: [id])
+
+  categories Category[] @relation(references: [id])
+  skills     Skill[]    @relation(references: [id])
+
+  perks Perk[] @relation(references: [id])
+
 }
```


