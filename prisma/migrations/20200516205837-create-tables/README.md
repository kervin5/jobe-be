# Migration `20200516205837-create-tables`

This migration has been generated by Kervin at 5/16/2020, 8:58:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "UserStatus" AS ENUM ('ACTIVE', 'INACTIVE', 'DELETED');

CREATE TYPE "ApplicationStatus" AS ENUM ('NEW', 'VIEWED', 'REVIEWING', 'CONTACTED', 'HIRED', 'ARCHIVED');

CREATE TYPE "ApplicationNoteType" AS ENUM ('NOTE', 'STATUS');

CREATE TYPE "JobStatus" AS ENUM ('DRAFT', 'POSTED', 'DELETED', 'EDITING', 'EXPIRED', 'PENDING');

CREATE TABLE "public"."Application" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"job" text  NOT NULL ,"resume" text  NOT NULL ,"status" "ApplicationStatus" NOT NULL DEFAULT 'NEW',"updatedAt" timestamp(3)  NOT NULL ,"user" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."ApplicationNote" (
"application" text  NOT NULL ,"content" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"type" "ApplicationNoteType" NOT NULL DEFAULT 'NOTE',"updatedAt" timestamp(3)  NOT NULL ,"user" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Branch" (
"company" text  NOT NULL ,"description" text   ,"id" text  NOT NULL ,"location" text   ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Category" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Company" (
"description" text  NOT NULL ,"id" text  NOT NULL ,"location" text   ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Favorite" (
"id" text  NOT NULL ,"job" text  NOT NULL ,"user" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."File" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"mimetype" text  NOT NULL ,"path" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Job" (
"author" text  NOT NULL ,"branch" text  NOT NULL ,"compensationType" text  NOT NULL DEFAULT 'hourly',"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"cronTask" text   ,"description" text  NOT NULL ,"disclaimer" text   ,"id" text  NOT NULL ,"location" text  NOT NULL ,"maxCompensation" Decimal(65,30)  NOT NULL ,"minCompensation" Decimal(65,30)  NOT NULL ,"status" "JobStatus" NOT NULL DEFAULT 'DRAFT',"title" text  NOT NULL ,"type" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."JobCronTask" (
"id" text  NOT NULL ,"lastRun" timestamp(3)  NOT NULL ,"nextRun" timestamp(3)  NOT NULL ,"objectId" text  NOT NULL ,"result" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Location" (
"boundary" Decimal(65,30) []  ,"id" text  NOT NULL ,"latitude" Decimal(65,30)  NOT NULL ,"longitude" Decimal(65,30)  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Permission" (
"actions" text []  ,"id" text  NOT NULL ,"object" text  NOT NULL ,"role" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Resume" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"file" text  NOT NULL ,"id" text  NOT NULL ,"title" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"user" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Role" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Skill" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"branch" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"id" text  NOT NULL ,"location" text   ,"name" text  NOT NULL ,"password" text  NOT NULL ,"resetToken" text   ,"resetTokenExpiry" Decimal(65,30)   ,"role" text  NOT NULL ,"status" "UserStatus" NOT NULL DEFAULT 'ACTIVE',"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_CategoryToJob" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_JobToSkill" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_ResumeToSkill" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_SkillToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "Category.name" ON "public"."Category"("name")

CREATE UNIQUE INDEX "File.path" ON "public"."File"("path")

CREATE UNIQUE INDEX "Job_cronTask" ON "public"."Job"("cronTask")

CREATE UNIQUE INDEX "JobCronTask.objectId" ON "public"."JobCronTask"("objectId")

CREATE UNIQUE INDEX "Skill.name" ON "public"."Skill"("name")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "_CategoryToJob_AB_unique" ON "public"."_CategoryToJob"("A","B")

CREATE  INDEX "_CategoryToJob_B_index" ON "public"."_CategoryToJob"("B")

CREATE UNIQUE INDEX "_JobToSkill_AB_unique" ON "public"."_JobToSkill"("A","B")

CREATE  INDEX "_JobToSkill_B_index" ON "public"."_JobToSkill"("B")

CREATE UNIQUE INDEX "_ResumeToSkill_AB_unique" ON "public"."_ResumeToSkill"("A","B")

CREATE  INDEX "_ResumeToSkill_B_index" ON "public"."_ResumeToSkill"("B")

CREATE UNIQUE INDEX "_SkillToUser_AB_unique" ON "public"."_SkillToUser"("A","B")

CREATE  INDEX "_SkillToUser_B_index" ON "public"."_SkillToUser"("B")

ALTER TABLE "public"."Application" ADD FOREIGN KEY ("resume")REFERENCES "public"."Resume"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Application" ADD FOREIGN KEY ("job")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Application" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ApplicationNote" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ApplicationNote" ADD FOREIGN KEY ("application")REFERENCES "public"."Application"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Branch" ADD FOREIGN KEY ("company")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Branch" ADD FOREIGN KEY ("location")REFERENCES "public"."Location"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("location")REFERENCES "public"."Location"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Favorite" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Favorite" ADD FOREIGN KEY ("job")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("author")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("location")REFERENCES "public"."Location"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("branch")REFERENCES "public"."Branch"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("cronTask")REFERENCES "public"."JobCronTask"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("role")REFERENCES "public"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Resume" ADD FOREIGN KEY ("file")REFERENCES "public"."File"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Resume" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("location")REFERENCES "public"."Location"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("role")REFERENCES "public"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("branch")REFERENCES "public"."Branch"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToJob" ADD FOREIGN KEY ("A")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToJob" ADD FOREIGN KEY ("B")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_JobToSkill" ADD FOREIGN KEY ("A")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_JobToSkill" ADD FOREIGN KEY ("B")REFERENCES "public"."Skill"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ResumeToSkill" ADD FOREIGN KEY ("A")REFERENCES "public"."Resume"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ResumeToSkill" ADD FOREIGN KEY ("B")REFERENCES "public"."Skill"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SkillToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Skill"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SkillToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200516205837-create-tables
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,254 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+enum UserStatus {
+  ACTIVE
+  INACTIVE
+  DELETED
+}
+
+enum ApplicationStatus {
+  NEW
+  VIEWED
+  REVIEWING
+  CONTACTED
+  HIRED
+  ARCHIVED
+}
+
+enum ApplicationNoteType {
+  NOTE
+  STATUS
+}
+
+enum JobStatus {
+  DRAFT
+  POSTED
+  DELETED
+  EDITING
+  EXPIRED
+  PENDING
+}
+
+
+model Application {
+  id              String   @id @default(cuid())
+
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+ 
+  resumeId        String @map("resume")
+  resume          Resume @relation(fields: [resumeId], references: [id])
+  
+  jobId           String @map("job")
+  job             Job    @relation(fields: [jobId], references: [id])
+ 
+  status          ApplicationStatus @default(NEW) 
+
+  userId     String @map("user")
+  user       User   @relation(fields: [userId], references: [id])
+
+  notes ApplicationNote[]
+}
+
+model ApplicationNote {
+  id          String   @id @default(cuid())
+
+  userId      String @map("user")
+  user        User   @relation(fields: [userId], references: [id])
+
+  applicationId String @map("application")
+  application Application @relation(fields: [applicationId], references: [id])
+
+  content     String
+
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  type        ApplicationNoteType @default(NOTE)
+}
+
+model Branch {
+  id          String  @id @default(cuid())
+  name        String
+
+  companyId   String @map("company")
+  company     Company  @relation(fields: [companyId], references: [id])
+
+  locationId    String? @map("location")
+  location    Location? @relation(fields: [locationId], references: [id])
+
+  description String?
+
+  jobs         Job[]  
+  users        User[]
+}
+
+
+model Category {
+  id   String @id @default(cuid())
+  name String @unique
+  jobs  Job[]  @relation(references: [id])
+}
+
+model Company {
+  id          String  @id @default(cuid())
+  name        String
+  description String
+  locationId  String? @map("location")
+  location    Location? @relation(fields: [locationId], references: [id])
+  branches      Branch[]
+}
+
+model Favorite {
+  id   String  @id @default(cuid())
+  userId String @map("user")
+  user User @relation(fields: [userId], references: [id])
+
+  jobId  String @map("job")
+  job Job  @relation(fields: [jobId], references: [id])
+}
+
+model File {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  mimetype  String
+  path      String   @unique
+}
+
+model Job {
+  id                                    String      @id @default(cuid())
+  createdAt                             DateTime    @default(now())
+  updatedAt                             DateTime    @updatedAt
+  title                                 String
+  compensationType                      String @default("hourly")
+  description                           String
+  disclaimer                            String?
+  type                                  String
+  maxCompensation                       Float
+  minCompensation                       Float
+
+  authorId                              String @map("author")
+  author                                User   @relation(fields: [authorId], references: [id])
+
+  locationId                            String @map("location")
+  location                              Location @relation(fields: [locationId], references: [id])
+
+  applications                          Application[]
+  categories                            Category[]    @relation(references: [id])
+  skills                                Skill[]       @relation(references: [id])
+  
+  status                                JobStatus @default(DRAFT)
+  favorites                             Favorite[]
+
+  branchId                              String @map("branch")
+  branch                                Branch @relation(fields: [branchId], references: [id])
+  
+  cronTaskId                            String? @map("cronTask")
+  cronTask                              JobCronTask?  @relation( fields: [cronTaskId], references: [id])
+
+}
+
+model JobCronTask {
+  id                            String   @id @default(cuid())
+  job                           Job    
+  lastRun                       DateTime
+  nextRun                       DateTime
+  objectId                      String   @unique
+  result                        String
+}
+
+model Location {
+  id                String  @id @default(now())
+  name              String
+  latitude          Float
+  longitude         Float
+  jobs               Job[]
+  boundary          Float[]
+  users              User[]
+}
+
+//model Location_boundary {
+  
+//  position Int
+  //value    Float
+ // locationId String @map("location")
+ // location Location @relation(fields: [locationId], references: [id])
+
+  //@@id([locationId, position])
+//}
+
+model Permission {
+  id                 String @id @default(cuid())
+  object             String
+  roleId               String @map("role")
+  role               Role               @relation(fields: [roleId], references: [id])
+  actions String[]
+}
+
+//model Permission_actions {
+  //position   Int
+  //value      String
+  //permissionId     String @map("permission")
+  //permission Permission @relation(fields: [permissionId], references: [id])
+  //@@id([permissionId, position])
+//}
+
+model Resume {
+  id          String      @id @default(cuid())
+  title       String
+  fileId        String     @map("file")
+  file        File         @relation(fields: [fileId], references: [id])
+  userId      String        @map("user")
+  user        User        @relation(fields: [userId], references: [id])
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime  @updatedAt
+  applications Application[]
+  skills       Skill[]       @relation(references: [id])
+}
+
+model Role {
+  id         String       @id @default(cuid())
+  name       String       
+  permissions Permission[]
+  users       User[]
+}
+
+model Skill {
+  id     String   @id @default(cuid()) 
+  name   String   @unique
+  jobs   Job[]    @relation(references: [id])
+  resumes Resume[] @relation(references: [id])
+  users   User[]   @relation(references: [id])
+}
+
+model User {
+  id               String      @id @default(cuid()) 
+  name             String
+  email            String      @unique
+  password         String
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt()
+  applications     Application[]
+  jobs             Job[]
+  locationId       String? @map("location")
+  location         Location? @relation(fields: [locationId], references: [id])
+  skills            Skill[]           @relation(references: [id])
+  favorites         Favorite[]
+  roleId            String @map("role")
+  role             Role          @relation(fields: [roleId], references: [id])
+
+  branchId         String? @map("branch")
+  branch           Branch?        @relation(fields: [branchId], references: [id])
+
+  resumes           Resume[]
+  resetToken       String?
+  resetTokenExpiry Float?
+  status           UserStatus @default(ACTIVE)
+}
```


