# Migration `20200603143752-create-perk-type`

This migration has been generated by Kervin at 6/3/2020, 2:37:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "myexactjobs-prisma-prod$prod"."Perk" (
"author" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "myexactjobs-prisma-prod$prod"."_JobToPerk" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "myexactjobs-prisma-prod$prod"."Application" ALTER COLUMN "status" SET DEFAULT E'NEW';

ALTER TABLE "myexactjobs-prisma-prod$prod"."ApplicationNote" ALTER COLUMN "type" SET DEFAULT E'NOTE';

ALTER TABLE "myexactjobs-prisma-prod$prod"."Job" ALTER COLUMN "status" SET DEFAULT E'DRAFT';

ALTER TABLE "myexactjobs-prisma-prod$prod"."User" ALTER COLUMN "status" SET DEFAULT E'ACTIVE';

CREATE UNIQUE INDEX "_JobToPerk_AB_unique" ON "myexactjobs-prisma-prod$prod"."_JobToPerk"("A","B")

CREATE  INDEX "_JobToPerk_B_index" ON "myexactjobs-prisma-prod$prod"."_JobToPerk"("B")

ALTER TABLE "myexactjobs-prisma-prod$prod"."Perk" ADD FOREIGN KEY ("author")REFERENCES "myexactjobs-prisma-prod$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobToPerk" ADD FOREIGN KEY ("A")REFERENCES "myexactjobs-prisma-prod$prod"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "myexactjobs-prisma-prod$prod"."_JobToPerk" ADD FOREIGN KEY ("B")REFERENCES "myexactjobs-prisma-prod$prod"."Perk"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200519140431-change-id-type-for-location..20200603143752-create-perk-type
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 enum UserStatus {
   ACTIVE
@@ -35,220 +35,214 @@
   EXPIRED
   PENDING
 }
-
 model Application {
-  id              String   @id @default(cuid())
+  id String @id @default(cuid())
-  createdAt       DateTime @default(now())
-  updatedAt       DateTime @updatedAt
- 
-  resumeId        String @map("resume")
-  resume          Resume @relation(fields: [resumeId], references: [id])
-  
-  jobId           String @map("job")
-  job             Job    @relation(fields: [jobId], references: [id])
- 
-  status          ApplicationStatus @default(NEW) 
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
-  userId     String @map("user")
-  user       User   @relation(fields: [userId], references: [id])
+  resumeId String @map("resume")
+  resume   Resume @relation(fields: [resumeId], references: [id])
+  jobId String @map("job")
+  job   Job    @relation(fields: [jobId], references: [id])
+
+  status ApplicationStatus @default(NEW)
+
+  userId String @map("user")
+  user   User   @relation(fields: [userId], references: [id])
+
   notes ApplicationNote[]
 }
 model ApplicationNote {
-  id          String   @id @default(cuid())
+  id String @id @default(cuid())
-  userId      String @map("user")
-  user        User   @relation(fields: [userId], references: [id])
+  userId String @map("user")
+  user   User   @relation(fields: [userId], references: [id])
-  applicationId String @map("application")
-  application Application @relation(fields: [applicationId], references: [id])
+  applicationId String      @map("application")
+  application   Application @relation(fields: [applicationId], references: [id])
-  content     String
+  content String
-  createdAt   DateTime  @default(now())
-  updatedAt   DateTime  @updatedAt
-  type        ApplicationNoteType @default(NOTE)
+  createdAt DateTime            @default(now())
+  updatedAt DateTime            @updatedAt
+  type      ApplicationNoteType @default(NOTE)
 }
 model Branch {
-  id          String  @id @default(cuid())
-  name        String
+  id   String @id @default(cuid())
+  name String
-  companyId   String @map("company")
-  company     Company  @relation(fields: [companyId], references: [id])
+  companyId String  @map("company")
+  company   Company @relation(fields: [companyId], references: [id])
-  locationId    String? @map("location")
-  location    Location? @relation(fields: [locationId], references: [id])
+  locationId String?   @map("location")
+  location   Location? @relation(fields: [locationId], references: [id])
   description String?
-  jobs         Job[]  
-  users        User[]
+  jobs  Job[]
+  users User[]
 }
-
 model Category {
   id   String @id @default(cuid())
   name String @unique
-  jobs  Job[]  @relation(references: [id])
+  jobs Job[]  @relation(references: [id])
 }
 model Company {
-  id          String  @id @default(cuid())
+  id          String    @id @default(cuid())
   name        String
   description String
-  locationId  String? @map("location")
+  locationId  String?   @map("location")
   location    Location? @relation(fields: [locationId], references: [id])
-  branches      Branch[]
+  branches    Branch[]
 }
 model Favorite {
-  id   String  @id @default(cuid())
+  id     String @id @default(cuid())
   userId String @map("user")
-  user User @relation(fields: [userId], references: [id])
+  user   User   @relation(fields: [userId], references: [id])
-  jobId  String @map("job")
-  job Job  @relation(fields: [jobId], references: [id])
+  jobId String @map("job")
+  job   Job    @relation(fields: [jobId], references: [id])
 }
 model File {
   id        String   @id @default(cuid())
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   mimetype  String
   path      String   @unique
+  Resume    Resume[]
 }
 model Job {
-  id                                    String      @id @default(cuid())
-  createdAt                             DateTime    @default(now())
-  updatedAt                             DateTime    @updatedAt
-  title                                 String
-  compensationType                      String @default("hourly")
-  description                           String
-  disclaimer                            String?
-  type                                  String
-  maxCompensation                       Float
-  minCompensation                       Float
+  id               String   @id @default(cuid())
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt
+  title            String
+  compensationType String   @default("hourly")
+  description      String
+  disclaimer       String?
+  type             String
+  maxCompensation  Float
+  minCompensation  Float
-  authorId                              String @map("author")
-  author                                User   @relation(fields: [authorId], references: [id])
+  authorId String @map("author")
+  author   User   @relation(fields: [authorId], references: [id])
-  locationId                            String @map("location")
-  location                              Location @relation(fields: [locationId], references: [id])
+  locationId String   @map("location")
+  location   Location @relation(fields: [locationId], references: [id])
-  applications                          Application[]
-  categories                            Category[]    @relation(references: [id])
-  skills                                Skill[]       @relation(references: [id])
-  
-  status                                JobStatus @default(DRAFT)
-  favorites                             Favorite[]
+  applications Application[]
+  categories   Category[]    @relation(references: [id])
+  skills       Skill[]       @relation(references: [id])
-  branchId                              String @map("branch")
-  branch                                Branch @relation(fields: [branchId], references: [id])
-  
-  cronTaskId                            String? @map("cronTask")
-  cronTask                              JobCronTask?  @relation( fields: [cronTaskId], references: [id])
+  status    JobStatus  @default(DRAFT)
+  favorites Favorite[]
+  branchId String @map("branch")
+  branch   Branch @relation(fields: [branchId], references: [id])
+
+  cronTaskId String?      @map("cronTask")
+  cronTask   JobCronTask? @relation(fields: [cronTaskId], references: [id])
+
+  perks Perk[] @relation(references: [id])
 }
 model JobCronTask {
-  id                            String   @id @default(cuid())
-  job                           Job    
-  lastRun                       DateTime
-  nextRun                       DateTime
-  objectId                      String   @unique
-  result                        String
+  id       String   @id @default(cuid())
+  job      Job
+  lastRun  DateTime
+  nextRun  DateTime
+  objectId String   @unique
+  result   String
 }
 model Location {
-  id                String  @id @default(cuid())
-  name              String
-  latitude          Float
-  longitude         Float
-  jobs               Job[]
-  boundary          Float[]
-  users              User[]
+  id        String    @id @default(cuid())
+  name      String
+  latitude  Float
+  longitude Float
+  jobs      Job[]
+  boundary  Float[]
+  users     User[]
+  Branch    Branch[]
+  Company   Company[]
 }
-//model Location_boundary {
-  
-//  position Int
-  //value    Float
- // locationId String @map("location")
- // location Location @relation(fields: [locationId], references: [id])
-
-  //@@id([locationId, position])
-//}
-
 model Permission {
-  id                 String @id @default(cuid())
-  object             String
-  roleId               String @map("role")
-  role               Role               @relation(fields: [roleId], references: [id])
+  id      String   @id @default(cuid())
+  object  String
+  roleId  String   @map("role")
+  role    Role     @relation(fields: [roleId], references: [id])
   actions String[]
 }
-//model Permission_actions {
-  //position   Int
-  //value      String
-  //permissionId     String @map("permission")
-  //permission Permission @relation(fields: [permissionId], references: [id])
-  //@@id([permissionId, position])
-//}
-
 model Resume {
-  id          String      @id @default(cuid())
-  title       String
-  fileId        String     @map("file")
-  file        File         @relation(fields: [fileId], references: [id])
-  userId      String        @map("user")
-  user        User        @relation(fields: [userId], references: [id])
-  createdAt   DateTime @default(now())
-  updatedAt   DateTime  @updatedAt
+  id           String        @id @default(cuid())
+  title        String
+  fileId       String        @map("file")
+  file         File          @relation(fields: [fileId], references: [id])
+  userId       String        @map("user")
+  user         User          @relation(fields: [userId], references: [id])
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
   applications Application[]
   skills       Skill[]       @relation(references: [id])
 }
 model Role {
-  id         String       @id @default(cuid())
-  name       String       
+  id          String       @id @default(cuid())
+  name        String
   permissions Permission[]
   users       User[]
 }
 model Skill {
-  id     String   @id @default(cuid()) 
-  name   String   @unique
-  jobs   Job[]    @relation(references: [id])
+  id      String   @id @default(cuid())
+  name    String   @unique
+  jobs    Job[]    @relation(references: [id])
   resumes Resume[] @relation(references: [id])
   users   User[]   @relation(references: [id])
 }
 model User {
-  id               String      @id @default(cuid()) 
-  name             String
-  email            String      @unique
-  password         String
-  createdAt        DateTime @default(now())
-  updatedAt        DateTime @updatedAt()
-  applications     Application[]
-  jobs             Job[]
-  locationId       String? @map("location")
-  location         Location? @relation(fields: [locationId], references: [id])
-  skills            Skill[]           @relation(references: [id])
-  favorites         Favorite[]
-  roleId            String @map("role")
-  role             Role          @relation(fields: [roleId], references: [id])
+  id           String        @id @default(cuid())
+  name         String
+  email        String        @unique
+  password     String
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+  applications Application[]
+  jobs         Job[]
+  locationId   String?       @map("location")
+  location     Location?     @relation(fields: [locationId], references: [id])
+  skills       Skill[]       @relation(references: [id])
+  favorites    Favorite[]
+  roleId       String        @map("role")
+  role         Role          @relation(fields: [roleId], references: [id])
-  branchId         String? @map("branch")
-  branch           Branch?        @relation(fields: [branchId], references: [id])
+  branchId String? @map("branch")
+  branch   Branch? @relation(fields: [branchId], references: [id])
-  resumes           Resume[]
+  resumes          Resume[]
   resetToken       String?
   resetTokenExpiry Float?
-  status           UserStatus @default(ACTIVE)
-}
+  status           UserStatus        @default(ACTIVE)
+  applicationNotes ApplicationNote[]
+  perks            Perk[]
+}
+
+model Perk {
+  id       String @id @default(cuid())
+  name     String
+  jobs     Job[]  @relation(references: [id])
+  authorId String @map("author")
+  author   User   @relation(fields: [authorId], references: [id])
+}
```


